id: org.gnome.EasyTAG
runtime: org.gnome.Platform
runtime-version: '44'
sdk: org.gnome.Sdk
command: easytag
finish-args:
  # Full FS access in order to read media files.
  - --filesystem=host
  - --share=ipc
  - --share=network
  - --socket=fallback-x11
  - --socket=wayland
cleanup:
  - /include
  - /lib/pkgconfig
  - /lib/*.a
  - /lib/*.la

modules:
  - name: id3lib
    cleanup:
      - /bin
    sources:
      - type: archive
        url: http://downloads.sourceforge.net/id3lib/id3lib-3.8.3.tar.gz
        sha512: 3787e261f86933c1c2f2bff2c4b349b42f5d8636e489e4f39f9d75e6dfbdc79b87009a0f4ce4b786f2fb3dbc01ca9d56c4112095b46244f897e6c9a28573adaf
      - type: patch
        path: id3lib-3.8.3-autoreconf.patch
      - type: patch
        path: id3lib-3.8.3-io_helpers-163101.patch
      - type: patch
        path: id3lib-3.8.3-mkstemp.patch
      - type: patch
        path: id3lib-3.8.3-includes.patch
      - type: patch
        path: id3lib-vbr_buffer_overflow.patch
      - type: patch
        path: id3lib-3.8.3-missing-nullpointer-check.patch
      - type: patch
        path: id3lib-3.8.3-fix-utf16-stringlists.patch

  - name: libid3tag
    cleanup:
      - /bin
    rm-configure: true
    sources:
      - type: archive
        url: http://downloads.sourceforge.net/mad/libid3tag-0.15.1b.tar.gz
        sha512: ade7ce2a43c3646b4c9fdc642095174b9d4938b078b205cd40906d525acd17e87ad76064054a961f391edcba6495441450af2f68be69f116549ca666b069e6d3
      - type: patch
        path: libid3tag-0.15.1b-fix_overflow.patch
        strip-components: 0
      - type: patch
        path: libid3tag-0.15.1b-handle-unknown-encoding.patch
      - type: patch
        path: libid3tag-0.15.1b-id3v1-zero-padding.patch
      - type: patch
        path: libid3tag-0.15.1b-id3v2-endless-loop.patch
        strip-components: 0
      - type: patch
        path: libid3tag-0.15.1b-pkgconfig.patch
      - type: patch
        path: libid3tag-0.15.1b-gperf-size_t.patch
      - type: script
        commands:
          - autoreconf --force --install

  - name: taglib
    buildsystem: cmake
    cleanup:
      - /bin
    sources:
      - type: archive
        url: http://taglib.org/releases/taglib-1.11.1.tar.gz
        sha512: 7846775c4954ea948fe4383e514ba7c11f55d038ee06b6ea5a0a1c1069044b348026e76b27aa4ba1c71539aa8143e1401fab39184cc6e915ba0ae2c06133cb98

  - name: intltool
    cleanup:
      - "*"
    sources:
      - type: archive
        url: https://launchpad.net/intltool/trunk/0.51.0/+download/intltool-0.51.0.tar.gz
        sha256: 67c74d94196b153b774ab9f89b2fa6c6ba79352407037c8c14d5aeb334e959cd

  - name: libsoup-2.4
    buildsystem: meson
    config-opts:
      - "-Dtests=false"
    sources:
      - type: archive
        url: https://download.gnome.org/sources/libsoup/2.74/libsoup-2.74.3.tar.xz
        sha256: e4b77c41cfc4c8c5a035fcdc320c7bc6cfb75ef7c5a034153df1413fa1d92f13

  - name: easytag
    config-opts:
      - --disable-Werror
    run-tests: true
    sources:
      - type: git
        url: https://gitlab.gnome.org/GNOME/easytag.git
